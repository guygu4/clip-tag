# Render Blueprint: one Web Service + PostgreSQL. Deploy from repo root.
# After first deploy, set FRONTEND_ORIGIN to your service URL (e.g. https://clip-tag-xxxx.onrender.com).

databases:
  - name: cliptag-db
    databaseName: cliptag
    user: cliptag
    plan: free

services:
  - type: web
    name: clip-tag
    runtime: node
    plan: free

    buildCommand: |
      cd backend && npm install && npx prisma generate && npx prisma migrate deploy && cd ../frontend && npm install && npm run build

    startCommand: cd backend && node server.js

    envVars:
      - key: FRONTEND_DIST
        value: ../frontend/dist
      - key: DATABASE_URL
        fromDatabase:
          name: cliptag-db
          property: connectionString
      # Set in Render Dashboard. For direct video URL set VITE_VIDEO_URL; for Google Drive set VITE_VIDEO_URL=/api/video and VIDEO_SOURCE_URL to your Drive share link.
      - key: VITE_VIDEO_URL
        sync: false
      - key: VIDEO_SOURCE_URL
        sync: false
      # Set FRONTEND_ORIGIN in Render Dashboard to your service URL after first deploy (e.g. https://clip-tag-xxxx.onrender.com)
      # so CORS works if you ever use the API from another origin. Same-origin (this app) works without it.
